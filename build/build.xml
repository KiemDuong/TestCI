<?xml version="1.0" encoding="UTF-8"?>
<project name="TestCI" default="main" basedir=".">
    <property environment="env"/>
    <property name="RAW_BUILD_NUMBER" value="${env.BUILD_NUMBER}"/>
	  <script language="javascript"><![CDATA[
        var buildNum = parseInt(project.getProperty("RAW_BUILD_NUMBER"))
		var minorBuildNumber = buildNum % 100;
		var majorBuildNumber = (Math.floor(buildNum / 100)) % 100;
		var uberBuildNumber = (Math.floor(buildNum / 10000)) % 100;
        project.setProperty("minorBuildNumber", minorBuildNumber);
		project.setProperty("majorBuildNumber", majorBuildNumber);
		project.setProperty("uberBuildNumber", uberBuildNumber);
    ]]></script>
	<property name="VERSION_STRING" value="${uberBuildNumber}.${majorBuildNumber}.${minorBuildNumber}"/>
    <property file="settings.properties"/>
	<property name="curl.dir.absolute" location="${curl.bin}"/>
	<property name="output.dir.absolute" location="${output.dir}"/>
	<property name="icon.dir.absolute" location="${ICON_FILE}"/>
    <tstamp>
        <format property="TODAY_STAMP" pattern="yyyy_MM_dd" locale="en,US"/>
    </tstamp>
	<tstamp>
        <format property="MONTH_STAMP" pattern="M" locale="en,US"/>
    </tstamp>
	<property name="VERSION_NUM" value="${uberBuildNumber}.${majorBuildNumber}.${minorBuildNumber}"/>
	<property name="VERSION_STRING" value="${APP_NAME}${VERSION_NUM}"/>
	
    <target name="main" depends="upload-android" />
 
    <target name="upload-android">
        <copy file="${output.dir.absolute}/${APP_NAME}" tofile="${output.dir.absolute}/${VERSION_STRING}.apk"/>
		<exec executable="${curl.dir.absolute}/curl" dir="${output.dir.absolute}">
            <arg line="-F apk=@${VERSION_STRING}.apk" />
			<arg line="-F icon=@${icon.dir.absolute}" />
			<arg line="-F project_name=${PROJECT_NAME}" />
			<arg line="-F platform_name=${platform_name}" />
			<arg line="-F environment_name=${environment_name}" />
			<arg line="-F version_number=${VERSION_NUM}" />
			<arg line="-F version_name=${version_name}" />
			<arg line="-F change_log=${change_log}" />
			<arg line="-F pushlish_from=${publish_from}" />
			<arg line="-F pushlish_to=${publish_to}" />
			<arg line="${UPLOAD_URL}" />
        </exec>
    </target>
 
</project>